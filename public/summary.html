<html>
  <body>
    <link rel="stylesheet" href="css/summary.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <div class="container">
      <button id="generate">Generate</button>
      <table>
        <caption>
          Comparison Summary
        </caption>
      </table>
      <div class="userlist">
        <ul>
          {% for book in recs %}
          <li><a>{{ book }}</a></li>
          {% endfor %}
        </ul>
      </div>
      <h1>{{similarity}}</h1>
    </div>
  </body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    import {
      getStorage,
      ref,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-storage.js";
    const firebaseConfig = {
      apiKey: "AIzaSyAFaio6oLqhfsBG5etudPimq_tXb8Fj4Mo",
      authDomain: "cs-222.firebaseapp.com",
      projectId: "cs-222",
      storageBucket: "cs-222.appspot.com",
      messagingSenderId: "53375683213",
      appId: "1:53375683213:web:4cd1586bb3078ed3c930c4",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    document.getElementById("generate").addEventListener("click", () => {
      const gsRef = ref(
        storage,
        "gs://cs-222.appspot.com/Group-1-Project-main/book-vec-group.csv"
      );
      getDownloadURL(gsRef)
        .then((url) => {
          console.log(url);
          // `url` is the download URL for 'images/stars.jpg'
          const xhr = new XMLHttpRequest();
          xhr.responseType = "blob";
          xhr.onload = function (e) {
            if (this.status == 200) {
              // Note: .response instead of .responseText
              var blob = this.response;
              var reader = new FileReader();
              reader.readAsDataURL(blob);
              reader.onload = function (e) {
                var img = document.createElement("img");
                img.src = e.target.result;
                document.body.appendChild(img);
              };
            }
          };
          xhr.open("GET", url, true);
        })
        .catch((error) => {
          switch (error.code) {
            case "storage/object-not-found":
              // File doesn't exist
              break;
            case "storage/unauthorized":
              // User doesn't have permission to access the object
              break;
            case "storage/canceled":
              // User canceled the upload
              break;
            case "storage/unknown":
              // Unknown error occurred, inspect the server response
              break;
          }
        });
    });
  </script>
</html>
